# Verbose Logging Feature

## Overview

The Claude PM Framework now supports verbose logging of all prompts sent to Claude Code when the `--verbose` flag is used. This feature helps with debugging, auditing, and understanding the agent orchestration process.

## Usage

```bash
# Enable verbose logging for any command
claude-pm --verbose [command]

# Examples:
claude-pm --verbose push
claude-pm --verbose test
claude-pm --verbose deploy
```

## Log Location

When verbose mode is enabled, all prompts are logged to JSON files in the following directory structure:

```
.claude-pm/logs/prompts/
├── 2025-07-20/
│   ├── prompt_engineer_013311_162.json
│   ├── prompt_qa_013311_223.json
│   └── subprocess_qa_013311_223.json
└── 2025-07-21/
    └── ...
```

## Log File Structure

Each log file contains:

```json
{
  "timestamp": "2025-07-20T01:33:11.162506",
  "agent_type": "engineer",
  "task_description": "Implement user authentication system",
  "prompt_text": "...",
  "metadata": {
    "framework_version": "014",
    "delegation_id": "engineer_20250720_013311",
    "working_directory": "/path/to/project",
    "prompt_length": 1897,
    "verbose_mode": true
  },
  "model_info": {
    "selected_model": "claude-4-opus",
    "selection_method": "agent_specific",
    "source": "model_selector",
    "max_tokens": 8192
  }
}
```

## Implementation Details

### Modified Components

1. **PM Orchestrator** (`pm_orchestrator.py`):
   - Added `verbose` parameter to `__init__()`
   - Added `_log_prompt_to_file()` method
   - Logs prompts in `generate_agent_prompt()` when verbose is enabled

2. **Task Tool Helper** (`task_tool_helper.py`):
   - Added `verbose` parameter to `__init__()`
   - Added `_log_subprocess_prompt()` method
   - Logs subprocess creation prompts when verbose is enabled

3. **CLI Utils** (`cli_utils.py`):
   - Updated `create_pm_orchestrator_with_cli_context()` to pass verbose flag
   - Updated `create_task_tool_helper_with_cli_context()` to pass verbose flag

### Log Types

1. **PM Orchestrator Prompts** (`prompt_<agent>_<timestamp>.json`):
   - Direct prompts generated by the PM orchestrator
   - Used for agent delegation

2. **Subprocess Prompts** (`subprocess_<agent>_<timestamp>.json`):
   - Prompts generated for Task Tool subprocess creation
   - Include subprocess-specific metadata

## Benefits

1. **Debugging**: Easily review exact prompts sent to agents
2. **Auditing**: Track all agent interactions and delegations
3. **Analysis**: Understand prompt patterns and optimize workflows
4. **Development**: Test prompt generation without executing agents

## Performance Considerations

- Logging only occurs when `--verbose` flag is used
- Minimal performance impact (file I/O only)
- Log files are organized by date for easy management
- No automatic cleanup (manual management required)

## Future Enhancements

- Log rotation and automatic cleanup
- Prompt analysis tools
- Integration with monitoring systems
- Prompt template extraction from logs